# Rare Disease Multi-Omics Reporter

## Overview

This project is a larger, portfolio-style bioinformatics tool that mimics a pharma-style rare disease analysis pipeline. The goal is to take three main inputs:

- a VCF file with patient variants  
- an RNA-seq counts matrix  
- a phenotype description (free text)  

and produce a structured research-style report that combines:

- variant-level evidence (e.g. predicted pathogenicity)  
- expression and pathway evidence (DESeq2 + enrichment in R)  
- a narrative summary generated by a large language model (LLM)  

This is a learning and portfolio project, not a clinical decision-support tool.

---

## Dataset

The `data/` directory will hold small, synthetic example inputs to exercise the pipeline:

- `example.vcf.gz` – toy set of variants for a test patient  
- `counts.tsv` – RNA-seq count matrix (genes × samples), e.g. a few samples or a single patient vs control  
- `phenotypes.txt` – example phenotype descriptions (HPO-like or free text)  

These examples are designed to be lightweight but realistic enough to demonstrate the pipeline architecture and logic.

---

## Methods

The project is intentionally split across Python, R and LLM components, reflecting how real-world pipelines often work in pharma and rare disease genomics.

### Python components

- Command-line interface (CLI) to run the full pipeline  
  - Located in `src/rdmr/cli.py` and wired via `run_report.py`.  
  - Handles arguments: VCF path, counts path, phenotype text and report output path.

- Variant handling and scoring  
  - Parsing and filtering a VCF file.  
  - Feature extraction for variants (e.g. consequence, frequency, gene, impact scores).  
  - Applying or integrating a machine learning model for variant pathogenicity (e.g. Random Forest, inspired by a ClinVar-style classifier).

- Orchestration and integration  
  - Calling R scripts via system calls (e.g. `Rscript R/01_deseq2_analysis.R ...`).  
  - Managing intermediate outputs (variants, expression results, pathway tables and plots).  
  - Collecting all evidence to build a coherent context for the LLM.

- LLM report generation  
  - Calling an OpenAI model using the official Python client.  
  - Feeding it a structured summary of:  
    - top-ranked variants and candidate genes,  
    - differentially expressed genes and enriched pathways,  
    - the phenotype description.  
  - Producing a markdown report with sections such as “Findings”, “Supporting Evidence” and “Limitations (research only)”.

### R components

- Differential expression analysis  
  - A DESeq2 pipeline (e.g. `R/01_deseq2_analysis.R`) that:  
    - reads an RNA-seq count matrix,  
    - fits a negative binomial model,  
    - identifies significantly differentially expressed genes,  
    - writes results to `results/expression/` as CSV.

- Pathway and GO enrichment analysis  
  - Scripts (e.g. `R/02_pathway_analysis.R`) using `clusterProfiler` and `org.Hs.eg.db` or similar Bioconductor packages.  
  - Enrichment over Gene Ontology and/or curated gene sets.  
  - Export of pathway tables and simple plots (barplots, dotplots) to `results/expression/`.

- Visualisation and QC  
  - Optional scripts for PCA, volcano plots, and other QC figures.  
  - Outputs saved as PNGs, referenced later in the report.

### LLM integration

- A Python module that:  
  - Reads variant and expression outputs plus phenotype text.  
  - Constructs a carefully constrained prompt for the LLM.  
  - Requests a structured, concise research-style summary.  
- The LLM output is saved as markdown and can optionally be converted to PDF.

---

## Setup

1. Clone the repository:

    git clone <this-repo-url>
    cd rare_disease_multiomics_reporter

2. Create and activate a Python virtual environment:

    python -m venv .venv
    source .venv/bin/activate          # Windows PowerShell: .venv\Scripts\Activate.ps1

3. Install Python dependencies:

    pip install -r requirements.txt

   Typical dependencies include:
   - pandas  
   - numpy  
   - scikit-learn  
   - openai  

4. Install R and Bioconductor packages (inside R):

   - DESeq2  
   - clusterProfiler  
   - org.Hs.eg.db  
   - plus any additional packages for plots (e.g. ggplot2, enrichplot).

5. Set your OpenAI API key (required for LLM-based reporting):

   On macOS / Linux:

    export OPENAI_API_KEY="your_real_openai_key_here"

   On Windows PowerShell:

    $Env:OPENAI_API_KEY="your_real_openai_key_here"

---

## How to Run

At the minimum MVP stage, the CLI accepts file paths and phenotype text and will gradually be wired to the full pipeline.

Example command:

    python run_report.py \
      --vcf data/example.vcf.gz \
      --counts data/counts.tsv \
      --phenotypes "short stature, developmental delay" \
      --out results/reports/patient_001_report.md

Planned execution flow:

1. **Variant processing (Python)**  
   - Parse the VCF, filter by basic quality and frequency thresholds.  
   - Score variants using a simple ML-based pathogenicity model or rule-based system.  
   - Write a ranked variant table to `results/variants/`.

2. **Expression and pathway analysis (R)**  
   - Python calls the R DESeq2 script:  
       Rscript R/01_deseq2_analysis.R data/counts.tsv results/expression/  
   - R writes DESeq2 results and plots.  
   - Python then calls the pathway analysis script:  
       Rscript R/02_pathway_analysis.R results/expression/deseq_results.csv results/expression/  

3. **LLM report generation (Python)**  
   - Python loads:  
     - top variants and genes,  
     - DE results and enriched pathways,  
     - the original phenotype text.  
   - It builds a prompt and calls the LLM using the OpenAI client.  
   - The LLM output is saved to `results/reports/patient_001_report.md`.

Over time, additional options (e.g. configuration files, logging, multiple patients) can be added to the CLI.

---

## Results

At early stages of development, results will be simple:

- Skeleton runs where the CLI prints the provided input paths and a TODO message.  
- Placeholder R scripts that echo their arguments and confirm data flow.  

As the project matures, expected outputs under `results/` include:

- `results/variants/`  
  - Filtered and scored variant tables (TSV/CSV) with gene, consequence, frequencies and model scores.

- `results/expression/`  
  - DESeq2 gene-level results (log2 fold changes, p-values, adjusted p-values).  
  - GO / pathway enrichment tables from clusterProfiler.  
  - QC and visualisation plots (volcano plots, barplots, PCA).

- `results/reports/`  
  - Markdown files containing LLM-generated summaries of each analysis.  
  - Optionally, rendered PDFs created from the markdown.

These outputs are intended for demonstration, learning and portfolio purposes only.

---

## Discussion

This repository is designed as a realistic, portfolio-grade example of how a junior bioinformatician can design and implement a multi-omics analysis and reporting workflow that spans:

- Python for orchestration, variant processing, ML, and LLM integration.  
- R / Bioconductor for robust statistical analysis of RNA-seq and pathway enrichment.  
- Modern LLMs for generating human-readable summaries of complex genomic evidence.

Key design principles include:

- Clear separation of concerns across languages (Python vs R vs LLM).  
- Reproducible file-based data flow (`data/` → `results/variants/`, `results/expression/`, `results/reports/`).  
- A command-line interface that makes the pipeline easy to run and extend.  

Planned extensions:

- More sophisticated variant scoring, integrating annotations such as consequence, impact and external scores.  
- Support for multiple patients or cohorts, not just a single toy example.  
- More advanced prompt engineering and safety constraints for the LLM outputs.  
- Lightweight tests (Python and R) to catch regressions as the project grows.

Overall, this project aims to demonstrate practical skills at the intersection of bioinformatics, software engineering and AI, in a form that is directly relevant to rare disease and pharma-focused workflows.

